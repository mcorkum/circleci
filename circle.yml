machine:
  timezone:
    America/Chicago

  php:
    version: 7.1.3

  # This will be added to the `/etc/hosts` file
  hosts:
    caldera.dev: 127.0.0.1

dependencies:
  pre:
    # No password is required for the MySQL user `ubuntu`
    - mysql -e 'CREATE DATABASE wordpress;' -uroot

    # Use cURL to fetch WP-CLI
    - curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar

    # Make sure WP-CLI is executable
    - chmod +x wp-cli.phar

    # Download WordPress into `wordpress` directory
    - ./wp-cli.phar core download --allow-root --path=wordpress

    # Generate `wp-config.php` file
    - ./wp-cli.phar core config --allow-root --dbname=wordpress --dbuser=root --dbuser=root --dbhost=127.0.0.1 --path=wordpress

    # Install WordPress
    - ./wp-cli.phar core install --allow-root --admin_name=admin --admin_password=admin --admin_email=admin@example.com --url=http://caldera.dev:8080 --title=WordPress --path=wordpress

    # Install Caldera
    - ./wp-cli.phar plugin install caldera-forms --path=wordpress

    # Download ngrok and open tunnel to our application
    - wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
    - unzip ngrok-stable-linux-amd64.zip
    - chmod +x ngrok
    - ./ngrok authtoken $NGROK_TOKEN
    - ./ngrok http 8080:
        background: true
    # Download json parser for determining ngrok tunnel
    - wget https://stedolan.github.io/jq/download/linux64/jq
    - chmod +x jq


test:
  override:
    # This is just for us to see that the WP Pusher plugin was actually installed and is active
    - ./wp-cli.phar plugin list --path=wordpress